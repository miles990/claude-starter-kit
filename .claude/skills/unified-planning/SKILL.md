---
name: unified-planning
version: 1.0.0
description: Unified Planning Layer - æ™ºèƒ½æ•´åˆ spec-workflow èˆ‡ evolve PDCA
triggers: [plan, è¦åŠƒ, è¨ˆç•«, å°ˆæ¡ˆ, project, feature, åŠŸèƒ½]
dependencies:
  skills:
    - evolve
  mcp:
    - spec-workflow
---

# Unified Planning Layer v1.0

> å–®ä¸€å…¥å£ï¼Œæ™ºèƒ½è·¯ç”±åˆ°æœ€é©åˆçš„è¦åŠƒ/åŸ·è¡Œæ©Ÿåˆ¶

## è§¸ç™¼æ–¹å¼

```
/plan [ç›®æ¨™æè¿°]
/plan [ç›®æ¨™] --formal    # å¼·åˆ¶ä½¿ç”¨ spec-workflow
/plan [ç›®æ¨™] --quick     # å¼·åˆ¶ä½¿ç”¨ evolve PDCA
/plan --from-spec [name] # å¾å·²æœ‰ spec åŸ·è¡Œä»»å‹™
/plan --status           # æŸ¥çœ‹ç•¶å‰è¦åŠƒç‹€æ…‹
```

## æ ¸å¿ƒæ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Unified Planning Layer                        â”‚
â”‚                                                                  â”‚
â”‚  /plan [goal]                                                    â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Planning Router                           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  åˆ†æç›®æ¨™è¤‡é›œåº¦ï¼š                                           â”‚ â”‚
â”‚  â”‚  â€¢ å¤§å‹åŠŸèƒ½/ç³»çµ±/æ¶æ§‹ â†’ spec-workflow (æ­£å¼)               â”‚ â”‚
â”‚  â”‚  â€¢ ä¿®å¾©/æ”¹é€²/å°åŠŸèƒ½ â†’ evolve PDCA (å¿«é€Ÿ)                   â”‚ â”‚
â”‚  â”‚  â€¢ ç”¨æˆ¶æŒ‡å®š --formal/--quick å„ªå…ˆ                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€â”€ Quick Path â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚       â”‚                                                 â”‚        â”‚
â”‚       â”‚    evolve PDCA                                  â”‚        â”‚
â”‚       â”‚    Plan â†’ Do â†’ Check â†’ Act â†’ Memory            â”‚        â”‚
â”‚       â”‚                                                 â”‚        â”‚
â”‚       â””â”€â”€â”€ Formal Path â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”‚            spec-workflow                                         â”‚
â”‚            Requirements â†’ Design â†’ Tasks â†’ Approval              â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚            Task Executor (evolve instances)                      â”‚
â”‚            For each task: /evolve [task] --from-spec            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Shared Memory Layer                        â”‚ â”‚
â”‚  â”‚  .claude/memory/ â† å…©è€…å…±ç”¨ï¼ŒçŸ¥è­˜äº’é€š                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è·¯ç”±é‚è¼¯

### è‡ªå‹•åˆ¤æ–· (é è¨­)

| æ¢ä»¶ | è·¯ç”± |
|------|------|
| åŒ…å«ã€Œfeatureã€ã€Œsystemã€ã€Œarchitectureã€ã€Œé‡æ§‹ã€ã€Œç³»çµ±ã€ | spec-workflow |
| é ä¼°å½±éŸ¿ >10 å€‹æª”æ¡ˆ | spec-workflow |
| é ä¼°æ™‚é–“ >4 å°æ™‚ | spec-workflow |
| åŒ…å«ã€Œfixã€ã€Œimproveã€ã€Œaddã€ã€Œä¿®å¾©ã€ã€Œæ”¹é€²ã€ | evolve |
| å–®ä¸€æ˜ç¢ºä»»å‹™ | evolve |

### æ‰‹å‹•è¦†è“‹

```bash
--formal    # å¼·åˆ¶ spec-workflowï¼Œå³ä½¿æ˜¯å°ä»»å‹™
--quick     # å¼·åˆ¶ evolve PDCAï¼Œå³ä½¿æ˜¯å¤§åŠŸèƒ½
```

## åŸ·è¡Œæµç¨‹

### Path A: Quick (evolve PDCA)

```
/plan fix the login button
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Router: å°ä»»å‹™ â†’ evolve PDCA           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  evolve PDCA åŸ·è¡Œ                        â”‚
â”‚                                         â”‚
â”‚  1. æœå°‹ Memory ç›¸é—œç¶“é©—                 â”‚
â”‚  2. Plan: è¦åŠƒä¿®å¾©æ­¥é©Ÿ                   â”‚
â”‚  3. Do: åŸ·è¡Œä¿®å¾©                         â”‚
â”‚  4. Check: é©—è­‰çµæœ                      â”‚
â”‚  5. Act: è¨˜éŒ„ç¶“é©—åˆ° Memory               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
âœ… å®Œæˆï¼Œç¶“é©—å·²å„²å­˜
```

### Path B: Formal (spec-workflow)

```
/plan implement user authentication with OAuth
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Router: å¤§åŠŸèƒ½ â†’ spec-workflow          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  spec-workflow è¦åŠƒ                      â”‚
â”‚                                         â”‚
â”‚  1. å»ºç«‹ specs/.specs/auth-system/       â”‚
â”‚  2. æ’°å¯« requirements.md                 â”‚
â”‚  3. æ’°å¯« design.md                       â”‚
â”‚  4. ç”¢ç”Ÿ tasks.md (ä»»å‹™æ¸…å–®)             â”‚
â”‚  5. è«‹æ±‚å¯©æ‰¹ (Dashboard)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (å¯©æ‰¹é€šéå¾Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Task Executor                           â”‚
â”‚                                         â”‚
â”‚  For each task in tasks.md:             â”‚
â”‚    /evolve [task] --from-spec auth      â”‚
â”‚    - åŸ·è¡Œå–®å€‹ä»»å‹™                        â”‚
â”‚    - æ›´æ–° tasks.md ç‹€æ…‹                  â”‚
â”‚    - log-implementation è¨˜éŒ„            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
âœ… æ‰€æœ‰ä»»å‹™å®Œæˆï¼Œspec æ¨™è¨˜ç‚º DONE
```

### Path C: From Spec (ç¹¼çºŒåŸ·è¡Œ)

```
/plan --from-spec auth-system
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®€å– specs/.specs/auth-system/tasks.md  â”‚
â”‚                                         â”‚
â”‚  æ‰¾åˆ°æœªå®Œæˆçš„ä»»å‹™ï¼š                      â”‚
â”‚  - [ ] Task 3: Implement token refresh  â”‚
â”‚  - [ ] Task 4: Add logout endpoint      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾åºåŸ·è¡Œå‰©é¤˜ä»»å‹™                        â”‚
â”‚  /evolve "Implement token refresh"      â”‚
â”‚  /evolve "Add logout endpoint"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä»»å‹™éŠœæ¥å”è­°

### tasks.md æ ¼å¼ (spec-workflow è¼¸å‡º)

```markdown
## Tasks

- [x] 1. Setup project structure
      context: Basic Express setup
      acceptance: Server starts on port 3000

- [-] 2. Implement login endpoint
      context: |
        Use JWT for tokens
        See design.md#auth-flow
      acceptance: |
        - POST /api/login accepts email/password
        - Returns valid JWT on success
        - Returns 401 on failure

- [ ] 3. Implement token refresh
      context: Refresh token rotation
      acceptance: POST /api/refresh returns new tokens
```

### evolve è®€å–ä¸¦åŸ·è¡Œ

ç•¶ evolve åŸ·è¡Œ `--from-spec` ä»»å‹™æ™‚ï¼š

1. **è§£æ context**: è¼‰å…¥ç›¸é—œè¨­è¨ˆæ–‡æª”
2. **è§£æ acceptance**: è¨­å®šé©—æ”¶æ¨™æº–
3. **åŸ·è¡Œ PDCA**: å¸¶è‘—å®Œæ•´ä¸Šä¸‹æ–‡åŸ·è¡Œ
4. **æ›´æ–°ç‹€æ…‹**: `- [ ]` â†’ `- [x]`
5. **è¨˜éŒ„å¯¦ä½œ**: å‘¼å« `log-implementation`

## å…±äº« Memory

å…©å€‹æ©Ÿåˆ¶å…±ç”¨åŒä¸€å€‹ Memory ç³»çµ±ï¼š

```
.claude/memory/
â”œâ”€â”€ learnings/      â† evolve å¯«å…¥æˆåŠŸç¶“é©—
â”œâ”€â”€ failures/       â† evolve å¯«å…¥å¤±æ•—æ•™è¨“
â”œâ”€â”€ decisions/      â† spec-workflow ADRs
â”œâ”€â”€ patterns/       â† evolve æ¨ç†æ¨¡å¼
â”œâ”€â”€ strategies/     â† evolve ç­–ç•¥æ± 
â””â”€â”€ specs/          â† spec-workflow specs é€£çµ (NEW)
    â””â”€â”€ README.md   # æŒ‡å‘ specs/.specs/
```

### Memory äº’é€šç¯„ä¾‹

```
1. spec-workflow å»ºç«‹ auth-system è¦æ ¼
   â†’ å¯«å…¥ .claude/memory/decisions/003-auth-design.md

2. evolve åŸ·è¡Œ Task 1
   â†’ æœå°‹ Memory æ‰¾åˆ° 003-auth-design.md
   â†’ æ‡‰ç”¨è¨­è¨ˆæ±ºç­–
   â†’ å®Œæˆå¾Œå¯«å…¥ learnings/

3. evolve åŸ·è¡Œ Task 2
   â†’ æœå°‹ Memory æ‰¾åˆ° Task 1 çš„ learnings
   â†’ ç´¯ç©çŸ¥è­˜ï¼Œé¿å…é‡è¤‡è¸©å‘
```

## ç‹€æ…‹æŸ¥è©¢

```
/plan --status

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Planning Status                      â”‚
â”‚                                         â”‚
â”‚  Active Specs:                          â”‚
â”‚  â”œâ”€ auth-system (3/5 tasks done)        â”‚
â”‚  â””â”€ api-redesign (pending approval)     â”‚
â”‚                                         â”‚
â”‚  Recent evolve sessions:                â”‚
â”‚  â”œâ”€ fix-login-button âœ… (2h ago)        â”‚
â”‚  â””â”€ improve-perf âœ… (yesterday)         â”‚
â”‚                                         â”‚
â”‚  Memory stats:                          â”‚
â”‚  â”œâ”€ Learnings: 25 entries               â”‚
â”‚  â”œâ”€ Failures: 4 entries                 â”‚
â”‚  â””â”€ Last updated: 10 min ago            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1: å¿«é€Ÿä¿®å¾©

```
User: /plan fix the TypeScript compilation error in auth module

Agent:
ğŸ”€ è·¯ç”±åˆ†æï¼šå°å‹ä¿®å¾©ä»»å‹™ â†’ evolve PDCA

ğŸ“‹ é–‹å§‹åŸ·è¡Œ...
[evolve PDCA æµç¨‹]
...
âœ… å®Œæˆï¼éŒ¯èª¤å·²ä¿®å¾©ï¼Œç¶“é©—å·²è¨˜éŒ„ã€‚
```

### ç¯„ä¾‹ 2: å¤§å‹åŠŸèƒ½

```
User: /plan implement a complete user management system with RBAC

Agent:
ğŸ”€ è·¯ç”±åˆ†æï¼šå¤§å‹ç³»çµ±åŠŸèƒ½ â†’ spec-workflow

ğŸ“ å»ºç«‹è¦æ ¼æ–‡æª”...
- specs/.specs/user-management/requirements.md
- specs/.specs/user-management/design.md
- specs/.specs/user-management/tasks.md (12 tasks)

â³ ç­‰å¾…å¯©æ‰¹...
è«‹åœ¨ Dashboard å¯©æ ¸ä¸¦æ‰¹å‡†è¦æ ¼ã€‚

[å¯©æ‰¹é€šéå¾Œ]

ğŸš€ é–‹å§‹åŸ·è¡Œä»»å‹™...
Task 1/12: Setup user model âœ…
Task 2/12: Implement CRUD endpoints âœ…
...
```

### ç¯„ä¾‹ 3: å¼·åˆ¶æ¨¡å¼

```
User: /plan add a simple button --formal

Agent:
ğŸ”€ ç”¨æˆ¶æŒ‡å®š --formal â†’ spec-workflow

ğŸ“ å»ºç«‹è¦æ ¼æ–‡æª”...
ï¼ˆå³ä½¿æ˜¯ç°¡å–®ä»»å‹™ä¹Ÿæœƒå®Œæ•´èµ° spec-workflow æµç¨‹ï¼‰
```

### ç¯„ä¾‹ 4: ç¹¼çºŒåŸ·è¡Œ

```
User: /plan --from-spec user-management

Agent:
ğŸ“– è®€å– specs/.specs/user-management/tasks.md

å‰©é¤˜ä»»å‹™ï¼š
- [ ] Task 8: Implement role assignment
- [ ] Task 9: Add permission checking middleware
- [ ] Task 10: Create admin dashboard

ğŸš€ ç¹¼çºŒåŸ·è¡Œ...
```

## æœ€ä½³å¯¦è¸

### DO

- è®“ Router è‡ªå‹•åˆ¤æ–·ï¼Œå¤§å¤šæ•¸æƒ…æ³å®ƒæ˜¯å°çš„
- å¤§å‹åŠŸèƒ½ä½¿ç”¨ spec-workflowï¼Œç²å¾—å®Œæ•´æ–‡æª”
- å¿«é€Ÿè¿­ä»£ä½¿ç”¨ evolveï¼Œä¿æŒæ•æ·
- å®šæœŸæª¢æŸ¥ `--status` äº†è§£é€²åº¦

### DON'T

- ä¸è¦å°å°ä»»å‹™å¼·åˆ¶ --formalï¼ˆéåº¦è¨­è¨ˆï¼‰
- ä¸è¦å°å¤§åŠŸèƒ½å¼·åˆ¶ --quickï¼ˆç¼ºä¹è¦åŠƒï¼‰
- ä¸è¦å¿½ç•¥å¯©æ‰¹æµç¨‹ï¼ˆspec-workflow çš„åƒ¹å€¼ï¼‰
- ä¸è¦è·³é Memory æœå°‹ï¼ˆé‡è¤‡è¸©å‘ï¼‰

## èˆ‡å…¶ä»–å·¥å…·æ•´åˆ

### CLI

```bash
npx claude-starter-kit plan [goal] [options]
```

### MCP Tools

- `spec-workflow`: è¦æ ¼ç®¡ç†
- `skillpkg`: æŠ€èƒ½ç¿’å¾—
- `evolve`: PDCA åŸ·è¡Œ

### Workflows

æ­é… workflow æŒ‡ä»¤ä½¿ç”¨ï¼š

```bash
npx claude-starter-kit workflow plan    # æŸ¥çœ‹è¦åŠƒæœ€ä½³å¯¦è¸
npx claude-starter-kit workflow execute # æŸ¥çœ‹åŸ·è¡Œæœ€ä½³å¯¦è¸
```
